<h1>üìä <%= month %> <%= year %></h1>

<canvas id="weightChart" width="600" height="300"></canvas>

<script>
    let filteredWeights = <%- JSON.stringify(filteredWeights) %>;
    let data = []
    let comments = []

    filteredWeights.sort(function(a, b) {
        return new Date(a.date) - new Date(b.date);
    })

    for (let i = 0; i < filteredWeights.length; i++) {
        data.push(filteredWeights[i].weight)
        comments.push(filteredWeights[i].comment)
    }


const ctx = document.getElementById('weightChart').getContext('2d');

const chart = new Chart(ctx, {
    type: 'line',
    data: {
        labels: ["01", "02", "03", "04", "05", "06", "07"],
        datasets: [{
            label: '–í–µ—Å (–∫–≥)',
            title: 'ddd',
            data: data,
            comments: comments,
            borderColor: 'blue',
            backgroundColor: 'rgba(0, 0, 255, 0.1)',
            tension: 0.3
        }]
    },
    options: {
        plugins: {
            tooltip: {
                callbacks: {
                    label: function(context) {
                        let datasetLabel = context.dataset.label || ''
                        let value = `${datasetLabel}: ${context.formattedValue} –∫–≥`
                        let comment = `–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${context.dataset.comments[context.dataIndex] || ''}`
                        return [value, comment]
                    }
                }
            }
        },
        scales: {
            y: {
                beginAtZero: false
            }
        }
    }
});

</script>

<p>üìâ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å: <strong class="min-weight">74.7 –∫–≥</strong></p>
<p>üìà –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π –≤–µ—Å: <strong class="max-weight">75.5 –∫–≥</strong></p>
<p>‚öñ –°—Ä–µ–¥–Ω–∏–π –≤–µ—Å: <strong class="middle-weight">75.1 –∫–≥</strong></p>

<div class="all-weights-month">

</div>

<p><a href="/">‚¨Ö –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –º–µ—Å—è—Ü–µ–≤</a></p>
<script>
    let minWeight = document.querySelector('.min-weight')
    let maxWeight = document.querySelector('.max-weight')
    let middleWeight = document.querySelector('.middle-weight')
    let allWeightsInMonth = document.querySelector('.all-weights-month')

    let content = []
    for (let i = 0; i < filteredWeights.length; i++) {
        let date = new Date(filteredWeights[i].date)
        content.push(`<div class="edit-delete-buttons"><a href="/edit/${filteredWeights[i]._id}" data-weight-id="${i}">${date.getUTCDate()}.${date.getMonth() + 1}.${date.getFullYear()} - ${filteredWeights[i].weight} –∫–≥</a> <form method="POST" action="/delete/${filteredWeights[i]._id}"><button type="submit">–£–¥–∞–ª–∏—Ç—å</button></form></div>`)
    }
    allWeightsInMonth.innerHTML = content.join('\n')

    let maxValue = Math.max.apply(null, data)
    let minimum = Math.min(...data)
    let middle = 0
    for (let i = 0; i < data.length; i++) {
        middle = middle + data[i]
    }
    middle = middle / data.length
    middle = Math.floor(middle)

    minWeight.textContent = minimum
    maxWeight.textContent = maxValue
    middleWeight.textContent = middle
</script>

