<style>
    body { font-family: Arial, sans-serif; padding:40px; }
    #editor { height:300px; }
    #toolbar { margin-bottom: 8px; }
  </style>

<form action="/edited/<%= id %>" method="POST">
  <h2>Редактировать статью</h2>

  <div class="input-field">
    <input class="form-control" type="text" name="title" placeholder="Новое название" value="<%= title %>">
    <input type="hidden" name="description" class="hidden-input" value="<%= description %>">
  </div>
  <div id="editor" name="description"></div>

  <button type="submit" onclick="onSubmit()" class="btn btn-primary mb-3 mt-3">Сохранить</button>
  <button class="btn-primary btn"><a class="text-decoration-none text-white" href="/posts">Вернуться</a></button>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
  <script>
      let hiddenInput = document.querySelector('.hidden-input')
      const quill = new Quill('#editor', {
    theme: 'snow',
    modules: {
      toolbar: {
        container: [
          [{ 'header': [1, 2, false] }],
          ['bold', 'italic', 'underline'],
          [{ 'list': 'ordered' }, { 'list': 'bullet' }],
          ['link', 'image']  
        ],
        handlers: {
          image: function () {
            const url = prompt('Вставьте ссылку на изображение:');
            if (url && isValidImageUrl(url)) {
              const range = this.quill.getSelection();
              this.quill.insertEmbed(range.index, 'image', url);
            }
          }
        }
      }
    }
  });

  // Простая проверка на допустимую ссылку
  function isValidImageUrl(url) {
    return /^https?:\/\/.+\.(jpg|jpeg|png|gif|webp|svg)$/i.test(url);
  }
  let a = quill.clipboard.convert(hiddenInput.value)
  quill.setContents(a, 'silent')

  function onSubmit() {
    hiddenInput.value = JSON.stringify(quill.getContents())
    hiddenInput.value = quill.root.innerHTML
  }
  </script>
  </form>